import{r as d,c as S,ab as pe,b2 as c,G as I,E as f,H as e,I as t,J as n,Z as N,$ as k,u as r,bM as fe,bP as _e,a0 as w,bQ as q,ay as me,D as x,bR as ge,bS as ye,az as he,bT as be,bU as ke,bV as we,bW as xe,bC as Ce,bX as Pe}from"./vendor-DnpcOReH.js";import{_ as Ve,a as T}from"./index-D-0slm3i.js";const ze={class:"music-player"},Se={class:"card-header"},Ue={class:"folder-upload"},Ie={key:0,class:"folder-info"},Ne={key:1,class:"player-section"},Re={class:"now-playing"},Ee=["src"],Le={class:"progress-container"},Me={class:"time-display"},Te={class:"player-controls"},Ae={class:"volume-control"},je={key:2,class:"playlist-section"},Be={class:"playlist-header"},Fe={class:"pagination"},Oe=Object.assign({name:"MyMusicPlayer"},{__name:"music",setup(We){const u=d(null),A=d(null),_=d([]),p=d(-1),s=d(!1),R=d(""),g=d(0),y=d(0),C=d(""),P=d(1),V=d(10),m=d(!1),z=d(.7),h=S(()=>p.value>=0?_.value[p.value]:null),j=S(()=>p.value>0),B=S(()=>p.value<_.value.length-1),U=S(()=>{if(!C.value)return _.value;const a=C.value.toLowerCase();return _.value.filter(l=>l.name.toLowerCase().includes(a))}),D=S(()=>{const a=(P.value-1)*V.value,l=a+V.value;return U.value.slice(a,l)}),Q=a=>{g.value=a},G=a=>{H(a)},H=a=>{if(!u.value)return;const l=s.value;l&&u.value.pause(),u.value.currentTime=a,g.value=a,l&&u.value.play().then(()=>{s.value=!0}).catch(o=>{console.error("跳转后播放失败:",o),s.value=!1}),W()},J=a=>{u.value&&(u.value.volume=a)},X=()=>{A.value.click()},Z=a=>{const l=Array.from(a.target.files);if(l.length===0)return;_.value.forEach(v=>{URL.revokeObjectURL(v.url)});const o=l[0].webkitRelativePath.split("/");R.value=o.length>1?o[0]:"未知文件夹";const b=l.filter(v=>v.name.toLowerCase().endsWith(".mp3")&&v.type.startsWith("audio/"));_.value=b.map(v=>({name:v.name.replace(".mp3",""),url:URL.createObjectURL(v),file:v})).sort(()=>Math.random()-.5),a.target.value="",P.value=1,C.value="",g.value=0,y.value=0,s.value=!1,m.value=!1,_.value.length>0?(p.value=0,u.value&&u.value.load()):T.warning("所选文件夹中没有找到MP3文件")},K=()=>{m.value=!0,u.value&&(u.value.volume=z.value),s.value&&F()},Y=()=>{T.error("音频加载失败，请尝试其他歌曲"),s.value=!1,m.value=!1},F=async()=>{if(!(!u.value||!m.value))try{await u.value.play(),s.value=!0,y.value=u.value.duration||y.value}catch(a){console.error("播放失败:",a),T.error("播放失败: "+(a.message||"浏览器可能阻止了自动播放，请手动点击播放按钮")),s.value=!1}},ee=()=>{h.value&&(m.value?F():(s.value=!0,u.value&&u.value.load()))},le=()=>{u.value&&(u.value.pause(),s.value=!1)},ae=()=>{s.value?le():ee()},te=()=>{j.value&&(p.value--,s.value=!0,m.value=!1)},O=()=>{B.value?p.value++:p.value=0,s.value=!0,m.value=!1},ue=()=>{O()},oe=a=>{const l=_.value.findIndex(o=>o.name===a.name);l!==-1&&(p.value=l,s.value=!0,m.value=!1)},W=()=>{u.value&&requestAnimationFrame(()=>{g.value=u.value.currentTime,!y.value&&u.value.duration&&(y.value=u.value.duration)})},E=a=>{if(isNaN(a))return"00:00";const l=Math.floor(a/60),o=Math.floor(a%60);return`${l.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`};return pe(()=>{u.value&&(u.value.pause(),u.value.src=""),_.value.forEach(a=>{URL.revokeObjectURL(a.url)})}),(a,l)=>{const o=c("el-icon"),b=c("el-button"),v=c("el-text"),L=c("el-divider"),$=c("el-slider"),ne=c("el-button-group"),se=c("el-input"),M=c("el-table-column"),re=c("el-tag"),ie=c("el-table"),de=c("el-scrollbar"),ce=c("el-pagination"),ve=c("el-card");return f(),I("div",ze,[e(ve,{class:"player-card",shadow:"hover"},{header:t(()=>[n("div",Se,[n("h2",null,[e(o,null,{default:t(()=>[e(r(Pe))]),_:1}),l[5]||(l[5]=k("deepseek和我做的本地音乐播放器",-1))])])]),default:t(()=>[n("div",Ue,[e(b,{type:"primary",size:"large",onClick:X},{default:t(()=>[e(o,null,{default:t(()=>[e(r(fe))]),_:1}),l[6]||(l[6]=k(" 选择音乐文件夹 ",-1))]),_:1}),n("input",{type:"file",id:"folderInput",onChange:Z,webkitdirectory:"",multiple:"",accept:".mp3",hidden:"",ref_key:"folderInput",ref:A},null,544)]),R.value?(f(),I("div",Ie,[e(v,{type:"info"},{default:t(()=>[e(o,null,{default:t(()=>[e(r(_e))]),_:1}),k(" 已选择文件夹: "+w(R.value)+" ("+w(U.value.length)+" 首歌曲) ",1)]),_:1})])):N("",!0),h.value?(f(),I("div",Ne,[e(L),n("div",Re,[e(v,{tag:"b",size:"large"},{default:t(()=>[e(o,null,{default:t(()=>[e(r(q))]),_:1}),k(" 正在播放: "+w(h.value.name),1)]),_:1})]),n("audio",{ref_key:"audioPlayer",ref:u,src:h.value.url,onEnded:ue,onTimeupdate:W,onCanplay:K,onError:Y},null,40,Ee),n("div",Le,[e($,{modelValue:g.value,"onUpdate:modelValue":l[0]||(l[0]=i=>g.value=i),max:y.value,"format-tooltip":E,onChange:G,onInput:Q},null,8,["modelValue","max"]),n("div",Me,[n("span",null,w(E(g.value)),1),n("span",null,w(E(y.value)),1)])]),n("div",Te,[e(ne,null,{default:t(()=>[e(b,{disabled:!j.value,onClick:te,size:"large"},{default:t(()=>[e(o,null,{default:t(()=>[e(r(me))]),_:1})]),_:1},8,["disabled"]),e(b,{type:"primary",onClick:ae,size:"large",class:"play-btn"},{default:t(()=>[s.value?(f(),x(o,{key:0},{default:t(()=>[e(r(ge))]),_:1})):(f(),x(o,{key:1},{default:t(()=>[e(r(ye))]),_:1}))]),_:1}),e(b,{disabled:!B.value,onClick:O,size:"large"},{default:t(()=>[e(o,null,{default:t(()=>[e(r(he))]),_:1})]),_:1},8,["disabled"])]),_:1}),l[7]||(l[7]=n("div",{class:"placeholder-box"},null,-1)),n("div",Ae,[e(o,{class:"volume-icon"},{default:t(()=>[z.value>.6?(f(),x(r(be),{key:0})):z.value>0?(f(),x(r(ke),{key:1})):(f(),x(r(we),{key:2}))]),_:1}),e($,{modelValue:z.value,"onUpdate:modelValue":l[1]||(l[1]=i=>z.value=i),min:0,max:1,step:.1,"show-tooltip":!1,onInput:J,style:{width:"100px","margin-left":"10px"}},null,8,["modelValue"])])])])):N("",!0),U.value.length>0?(f(),I("div",je,[e(L),n("div",Be,[n("h3",null,[e(o,null,{default:t(()=>[e(r(xe))]),_:1}),l[8]||(l[8]=k(" 播放列表",-1))]),e(se,{modelValue:C.value,"onUpdate:modelValue":l[2]||(l[2]=i=>C.value=i),placeholder:"搜索歌曲",clearable:"",style:{width:"200px"}},{prefix:t(()=>[e(o,null,{default:t(()=>[e(r(Ce))]),_:1})]),_:1},8,["modelValue"])]),e(de,{height:"300px"},{default:t(()=>[e(ie,{data:D.value,stripe:"",style:{width:"100%"},onRowClick:oe,"highlight-current-row":"","current-row-key":p.value},{default:t(()=>[e(M,{prop:"index",label:"#",width:"50"},{default:t(({$index:i})=>[k(w((P.value-1)*V.value+i+1),1)]),_:1}),e(M,{prop:"name",label:"歌曲名称"}),e(M,{label:"状态",width:"80"},{default:t(({row:i})=>[h.value&&i.name===h.value.name?(f(),x(re,{key:0,type:"success",size:"small"},{default:t(()=>[e(o,null,{default:t(()=>[e(r(q))]),_:1})]),_:1})):N("",!0)]),_:1})]),_:1},8,["data","current-row-key"])]),_:1}),n("div",Fe,[e(ce,{"current-page":P.value,"onUpdate:currentPage":l[3]||(l[3]=i=>P.value=i),"page-size":V.value,"onUpdate:pageSize":l[4]||(l[4]=i=>V.value=i),total:U.value.length,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",background:""},null,8,["current-page","page-size","total"])])])):N("",!0)]),_:1})])}}}),De=Ve(Oe,[["__scopeId","data-v-eae708fd"]]);export{De as default};
