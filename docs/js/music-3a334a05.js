import{a as d,f as U,K as pe,aQ as c,T as p,U as N,a5 as e,$ as l,V as n,u as r,a3 as k,a4 as x,a2 as R,_ as w,bN as fe,bM as me,bO as he,bP as q,aJ as ge,bQ as ye,bR as be,aK as ke,bS as xe,bT as we,bU as Ce,bV as Se,bx as Ve,bJ as Pe,bK as Ue}from"./vendor-a9dfa730.js";import{_ as Ie,E as M}from"./index-b8bf9243.js";const ze=I=>(Pe("data-v-778edae6"),I=I(),Ue(),I),Ne={class:"music-player"},Re={class:"card-header"},Ee={class:"folder-upload"},Le={key:0,class:"folder-info"},Te={key:1,class:"player-section"},Ae={class:"now-playing"},Me=["src"],Be={class:"progress-container"},je={class:"time-display"},Fe={class:"player-controls"},Oe=ze(()=>n("div",{class:"placeholder-box"},null,-1)),Ke={class:"volume-control"},Qe={key:2,class:"playlist-section"},$e={class:"playlist-header"},qe={class:"pagination"},Je={__name:"music",setup(I){const o=d(null),B=d(null),f=d([]),_=d(-1),s=d(!1),E=d(""),h=d(0),g=d(0),C=d(""),S=d(1),V=d(10),m=d(!1),P=d(.7),y=U(()=>_.value>=0?f.value[_.value]:null),j=U(()=>_.value>0),F=U(()=>_.value<f.value.length-1),z=U(()=>{if(!C.value)return f.value;const a=C.value.toLowerCase();return f.value.filter(t=>t.name.toLowerCase().includes(a))}),J=U(()=>{const a=(S.value-1)*V.value,t=a+V.value;return z.value.slice(a,t)}),W=a=>{h.value=a},D=a=>{G(a)},G=a=>{if(!o.value)return;const t=s.value;t&&o.value.pause(),o.value.currentTime=a,h.value=a,t&&o.value.play().then(()=>{s.value=!0}).catch(u=>{console.error("跳转后播放失败:",u),s.value=!1}),Q()},H=a=>{o.value&&(o.value.volume=a)},X=()=>{B.value.click()},Y=a=>{const t=Array.from(a.target.files);if(t.length===0)return;f.value.forEach(v=>{URL.revokeObjectURL(v.url)});const u=t[0].webkitRelativePath.split("/");E.value=u.length>1?u[0]:"未知文件夹";const b=t.filter(v=>v.name.toLowerCase().endsWith(".mp3")&&v.type.startsWith("audio/"));f.value=b.map(v=>({name:v.name.replace(".mp3",""),url:URL.createObjectURL(v),file:v})).sort(()=>Math.random()-.5),a.target.value="",S.value=1,C.value="",h.value=0,g.value=0,s.value=!1,m.value=!1,f.value.length>0?(_.value=0,o.value&&o.value.load()):M.warning("所选文件夹中没有找到MP3文件")},Z=()=>{m.value=!0,o.value&&(o.value.volume=P.value),s.value&&O()},ee=()=>{M.error("音频加载失败，请尝试其他歌曲"),s.value=!1,m.value=!1},O=async()=>{if(!(!o.value||!m.value))try{await o.value.play(),s.value=!0,g.value=o.value.duration||g.value}catch(a){console.error("播放失败:",a),M.error("播放失败: "+(a.message||"浏览器可能阻止了自动播放，请手动点击播放按钮")),s.value=!1}},ae=()=>{y.value&&(m.value?O():(s.value=!0,o.value&&o.value.load()))},le=()=>{o.value&&(o.value.pause(),s.value=!1)},te=()=>{s.value?le():ae()},oe=()=>{j.value&&(_.value--,s.value=!0,m.value=!1)},K=()=>{F.value?_.value++:_.value=0,s.value=!0,m.value=!1},ue=()=>{K()},ne=a=>{const t=f.value.findIndex(u=>u.name===a.name);t!==-1&&(_.value=t,s.value=!0,m.value=!1)},Q=()=>{o.value&&requestAnimationFrame(()=>{h.value=o.value.currentTime,!g.value&&o.value.duration&&(g.value=o.value.duration)})},L=a=>{if(isNaN(a))return"00:00";const t=Math.floor(a/60),u=Math.floor(a%60);return`${t.toString().padStart(2,"0")}:${u.toString().padStart(2,"0")}`};return pe(()=>{o.value&&(o.value.pause(),o.value.src=""),f.value.forEach(a=>{URL.revokeObjectURL(a.url)})}),(a,t)=>{const u=c("el-icon"),b=c("el-button"),v=c("el-text"),T=c("el-divider"),$=c("el-slider"),se=c("el-button-group"),re=c("el-input"),A=c("el-table-column"),ie=c("el-tag"),de=c("el-table"),ce=c("el-scrollbar"),ve=c("el-pagination"),_e=c("el-card");return p(),N("div",Ne,[e(_e,{class:"player-card",shadow:"hover"},{header:l(()=>[n("div",Re,[n("h2",null,[e(u,null,{default:l(()=>[e(r(fe))]),_:1}),k("deepseek和我做的本地音乐播放器")])])]),default:l(()=>[n("div",Ee,[e(b,{type:"primary",size:"large",onClick:X},{default:l(()=>[e(u,null,{default:l(()=>[e(r(me))]),_:1}),k(" 选择音乐文件夹 ")]),_:1}),n("input",{type:"file",id:"folderInput",onChange:Y,webkitdirectory:"",multiple:"",accept:".mp3",hidden:"",ref_key:"folderInput",ref:B},null,544)]),E.value?(p(),N("div",Le,[e(v,{type:"info"},{default:l(()=>[e(u,null,{default:l(()=>[e(r(he))]),_:1}),k(" 已选择文件夹: "+x(E.value)+" ("+x(z.value.length)+" 首歌曲) ",1)]),_:1})])):R("",!0),y.value?(p(),N("div",Te,[e(T),n("div",Ae,[e(v,{tag:"b",size:"large"},{default:l(()=>[e(u,null,{default:l(()=>[e(r(q))]),_:1}),k(" 正在播放: "+x(y.value.name),1)]),_:1})]),n("audio",{ref_key:"audioPlayer",ref:o,src:y.value.url,onEnded:ue,onTimeupdate:Q,onCanplay:Z,onError:ee},null,40,Me),n("div",Be,[e($,{modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=i=>h.value=i),max:g.value,"format-tooltip":L,onChange:D,onInput:W},null,8,["modelValue","max"]),n("div",je,[n("span",null,x(L(h.value)),1),n("span",null,x(L(g.value)),1)])]),n("div",Fe,[e(se,null,{default:l(()=>[e(b,{disabled:!j.value,onClick:oe,size:"large"},{default:l(()=>[e(u,null,{default:l(()=>[e(r(ge))]),_:1})]),_:1},8,["disabled"]),e(b,{type:"primary",onClick:te,size:"large",class:"play-btn"},{default:l(()=>[s.value?(p(),w(u,{key:0},{default:l(()=>[e(r(ye))]),_:1})):(p(),w(u,{key:1},{default:l(()=>[e(r(be))]),_:1}))]),_:1}),e(b,{disabled:!F.value,onClick:K,size:"large"},{default:l(()=>[e(u,null,{default:l(()=>[e(r(ke))]),_:1})]),_:1},8,["disabled"])]),_:1}),Oe,n("div",Ke,[e(u,{class:"volume-icon"},{default:l(()=>[P.value>.6?(p(),w(r(xe),{key:0})):P.value>0?(p(),w(r(we),{key:1})):(p(),w(r(Ce),{key:2}))]),_:1}),e($,{modelValue:P.value,"onUpdate:modelValue":t[1]||(t[1]=i=>P.value=i),min:0,max:1,step:.1,"show-tooltip":!1,onInput:H,style:{width:"100px","margin-left":"10px"}},null,8,["modelValue"])])])])):R("",!0),z.value.length>0?(p(),N("div",Qe,[e(T),n("div",$e,[n("h3",null,[e(u,null,{default:l(()=>[e(r(Se))]),_:1}),k(" 播放列表")]),e(re,{modelValue:C.value,"onUpdate:modelValue":t[2]||(t[2]=i=>C.value=i),placeholder:"搜索歌曲",clearable:"",style:{width:"200px"}},{prefix:l(()=>[e(u,null,{default:l(()=>[e(r(Ve))]),_:1})]),_:1},8,["modelValue"])]),e(ce,{height:"300px"},{default:l(()=>[e(de,{data:J.value,stripe:"",style:{width:"100%"},onRowClick:ne,"highlight-current-row":"","current-row-key":_.value},{default:l(()=>[e(A,{prop:"index",label:"#",width:"50"},{default:l(({$index:i})=>[k(x((S.value-1)*V.value+i+1),1)]),_:1}),e(A,{prop:"name",label:"歌曲名称"}),e(A,{label:"状态",width:"80"},{default:l(({row:i})=>[y.value&&i.name===y.value.name?(p(),w(ie,{key:0,type:"success",size:"small"},{default:l(()=>[e(u,null,{default:l(()=>[e(r(q))]),_:1})]),_:1})):R("",!0)]),_:1})]),_:1},8,["data","current-row-key"])]),_:1}),n("div",qe,[e(ve,{"current-page":S.value,"onUpdate:currentPage":t[3]||(t[3]=i=>S.value=i),"page-size":V.value,"onUpdate:pageSize":t[4]||(t[4]=i=>V.value=i),total:z.value.length,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",background:""},null,8,["current-page","page-size","total"])])])):R("",!0)]),_:1})])}}},Ge=Ie(Je,[["__scopeId","data-v-778edae6"]]);export{Ge as default};
